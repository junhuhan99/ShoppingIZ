{
  "permissions": {
    "allow": [
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"cat > /home/ubuntu/ShoppingIZ/backend/.env << ''EOF''\nPORT=3000\nNODE_ENV=production\n\nDB_HOST=localhost\nDB_PORT=3306\nDB_USER=shoppingiz_user\nDB_PASSWORD=shoppingiz2025\nDB_NAME=shoppingiz_db\n\nJWT_SECRET=ShoppingIZ_JWT_Secret_2025\nJWT_EXPIRES_IN=7d\n\nCORS_ORIGIN=http://13.125.150.235\nEOF\n\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"pm2 restart shoppingiz-api\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"pm2 logs shoppingiz-api --lines 5 --nostream\")",
      "Bash(curl -s -v http://13.125.150.235/health)",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo mysql -e \"\"SELECT user, host, plugin FROM mysql.user WHERE user=''shoppingiz_user'';\"\"\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"mysql -u shoppingiz_user -pshoppingiz2025 -e ''SELECT 1;'' 2>&1\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"cat /home/ubuntu/ShoppingIZ/backend/.env\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"pm2 delete shoppingiz-api && cd /home/ubuntu/ShoppingIZ/backend && pm2 start src/app.js --name shoppingiz-api && pm2 save\")",
      "Bash(curl -s http://13.125.150.235/)",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"pm2 status\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo systemctl status nginx | head -20\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"curl -s http://localhost:3000/health\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo tail -20 /var/log/nginx/shoppingiz_error.log\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"curl -v http://localhost/health 2>&1 | head -30\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo ufw status\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo netstat -tuln | grep -E '':(80|3000|443)''\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo ss -tuln | grep -E '':(80|3000)''\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"curl -s http://localhost/health && echo ''''\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"pm2 status && echo '''' && echo ''✅ 서버 내부는 모두 정상입니다!''\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo tail -30 /var/log/nginx/shoppingiz_error.log\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo mkdir -p /var/www/shoppingiz && sudo chown -R ubuntu:ubuntu /var/www/shoppingiz\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"cat > /var/www/shoppingiz/index.html << ''EOF''\n<!DOCTYPE html>\n<html lang=\"\"ko\"\">\n<head>\n    <meta charset=\"\"UTF-8\"\">\n    <meta name=\"\"viewport\"\" content=\"\"width=device-width, initial-scale=1.0\"\">\n    <title>ShoppingIZ - 통합 가격비교 & 쿠폰 거래 플랫폼</title>\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, ''Segoe UI'', sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n        }\n        .container {\n            text-align: center;\n            padding: 2rem;\n            max-width: 800px;\n        }\n        h1 {\n            font-size: 3rem;\n            margin-bottom: 1rem;\n            animation: fadeIn 1s;\n        }\n        p {\n            font-size: 1.3rem;\n            margin-bottom: 2rem;\n            opacity: 0.9;\n        }\n        .features {\n            background: rgba(255,255,255,0.1);\n            border-radius: 15px;\n            padding: 2rem;\n            margin: 2rem 0;\n            backdrop-filter: blur(10px);\n        }\n        .feature {\n            margin: 1rem 0;\n            font-size: 1.1rem;\n        }\n        .status {\n            background: #28a745;\n            color: white;\n            padding: 0.5rem 1rem;\n            border-radius: 20px;\n            display: inline-block;\n            margin: 1rem 0;\n            font-weight: bold;\n        }\n        .api-link {\n            background: rgba(255,255,255,0.2);\n            padding: 1.5rem;\n            border-radius: 10px;\n            margin-top: 2rem;\n        }\n        .api-link a {\n            color: white;\n            text-decoration: none;\n            font-weight: bold;\n            font-size: 1.1rem;\n            border: 2px solid white;\n            padding: 0.8rem 2rem;\n            border-radius: 25px;\n            display: inline-block;\n            margin: 0.5rem;\n            transition: all 0.3s;\n        }\n        .api-link a:hover {\n            background: white;\n            color: #667eea;\n        }\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(-20px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"\"container\"\">\n        <h1>🛍️ ShoppingIZ</h1>\n        <p>통합 가격비교 & AI 구매 추천 & 쿠폰 거래 플랫폼</p>\n        \n        <div class=\"\"status\"\">✅ API 서버 정상 작동 중</div>\n        \n        <div class=\"\"features\"\">\n            <h2 style=\"\"margin-bottom: 1.5rem;\"\">주요 기능</h2>\n            <div class=\"\"feature\"\">🔍 실시간 가격 비교 (쿠팡, 네이버, 11번가, G마켓)</div>\n            <div class=\"\"feature\"\">🤖 AI 구매 추천 - \"\"지금 살지 말지 결정\"\"</div>\n            <div class=\"\"feature\"\">🎫 P2P 쿠폰 거래소 (에스크로 시스템)</div>\n            <div class=\"\"feature\"\">🔔 가격 추적 및 알림</div>\n            <div class=\"\"feature\"\">⭐ 포인트 적립 시스템</div>\n        </div>\n        \n        <div class=\"\"api-link\"\">\n            <h3 style=\"\"margin-bottom: 1rem;\"\">API 테스트</h3>\n            <a href=\"\"/health\"\" target=\"\"_blank\"\">헬스 체크</a>\n            <a href=\"\"/api/auth/login\"\" target=\"\"_blank\"\">로그인 API</a>\n            <a href=\"\"https://github.com/junhuhan99/ShoppingIZ\"\" target=\"\"_blank\"\">GitHub</a>\n        </div>\n        \n        <p style=\"\"margin-top: 2rem; font-size: 0.9rem; opacity: 0.7;\"\">\n            Backend: Node.js + Express | Database: MySQL | AI: TensorFlow.js<br>\n            Deployed on AWS EC2 | Nginx + PM2\n        </p>\n    </div>\n</body>\n</html>\nEOF\n\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo tee /etc/nginx/sites-available/shoppingiz > /dev/null << ''EOF''\nserver {\n    listen 80;\n    server_name 13.125.150.235;\n\n    # 로그 설정\n    access_log /var/log/nginx/shoppingiz_access.log;\n    error_log /var/log/nginx/shoppingiz_error.log;\n\n    # API 프록시 (백엔드)\n    location /api/ {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection ''upgrade'';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        # 타임아웃 설정\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # 헬스 체크\n    location /health {\n        proxy_pass http://localhost:3000/health;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n    }\n\n    # 정적 파일 (프론트엔드)\n    location / {\n        root /var/www/shoppingiz;\n        index index.html;\n        try_files $uri $uri/ /index.html;\n    }\n\n    # Gzip 압축\n    gzip on;\n    gzip_vary on;\n    gzip_min_length 1024;\n    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;\n}\nEOF\n\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"sudo nginx -t && sudo systemctl reload nginx\")",
      "Bash(curl -s http://13.125.150.235/api/auth/login -X POST -H \"Content-Type: application/json\" -d '{\"\"\"\"email\"\"\"\":\"\"\"\"test@test.com\"\"\"\",\"\"\"\"password\"\"\"\":\"\"\"\"test\"\"\"\"}')",
      "Bash(curl -X POST http://13.125.150.235/api/auth/login -H \"Content-Type: application/json\" -d '{\"\"email\"\":\"\"test@test.com\"\",\"\"password\"\":\"\"test123\"\"}' -v)",
      "Bash(curl -X POST http://13.125.150.235/api/auth/register -H \"Content-Type: application/json\" -d '{\"\"email\"\":\"\"test@test.com\"\",\"\"password\"\":\"\"test123\"\",\"\"nickname\"\":\"\"테스트유저\"\",\"\"phone\"\":\"\"01012345678\"\"}')",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"mysql -u shoppingiz_user -pshoppingiz2025 shoppingiz_db -e \"\"\nCREATE TABLE IF NOT EXISTS ad_products (\n    ad_id BIGINT PRIMARY KEY AUTO_INCREMENT,\n    product_id BIGINT NOT NULL,\n    is_active BOOLEAN DEFAULT TRUE,\n    priority INT DEFAULT 0,\n    ad_budget DECIMAL(10,2) DEFAULT 0,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE CASCADE,\n    UNIQUE KEY unique_product (product_id),\n    INDEX idx_active_priority (is_active, priority)\n);\"\"\")",
      "Bash(ssh -i \"D:\\쇼핑iz\\shoppingiz.pem\" -o StrictHostKeyChecking=no ubuntu@13.125.150.235 \"mysql -u shoppingiz_user -pshoppingiz2025 shoppingiz_db -e ''SHOW TABLES;''\")",
      "Bash(git commit -m \"Add admin routes and ad_products table\n\n- Added ad_products table for managing advertised products\n- Registered admin routes in app.js\n- Admin endpoints: products, prices, coupons, dashboard\n- Support for differentiating ad products from regular products\")",
      "Bash(git push origin main)"
    ],
    "deny": [],
    "ask": []
  }
}
